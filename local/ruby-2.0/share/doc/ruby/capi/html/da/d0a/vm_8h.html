<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Ruby: include/ruby/vm.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ruby
   &#160;<span id="projectnumber">2.0.0p247(2013-06-27revision41674)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_82434f6a8a39055b35115fc8d4134985.html">ruby</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">vm.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../da/d0a/vm_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:afd6d6bfc5b87b128cc4b33c5b259b01a"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../db/d74/structrb__vm__struct.html">rb_vm_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a></td></tr>
<tr class="separator:afd6d6bfc5b87b128cc4b33c5b259b01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a64b7830f0ac2f5c4e03c3659051b3e4b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#a64b7830f0ac2f5c4e03c3659051b3e4b">ruby_vm_destruct</a> (<a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a> *vm)</td></tr>
<tr class="separator:a64b7830f0ac2f5c4e03c3659051b3e4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a450d06a010ca9e1139e5ba87c5cb9e38"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#a450d06a010ca9e1139e5ba87c5cb9e38">ruby_vm_at_exit</a> (void(*<a class="el" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a> *))</td></tr>
<tr class="memdesc:a450d06a010ca9e1139e5ba87c5cb9e38"><td class="mdescLeft">&#160;</td><td class="mdescRight">ruby_vm_at_exit registers a function <em>func</em> to be invoked when a VM passed away.  <a href="#a450d06a010ca9e1139e5ba87c5cb9e38"></a><br/></td></tr>
<tr class="separator:a450d06a010ca9e1139e5ba87c5cb9e38"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="afd6d6bfc5b87b128cc4b33c5b259b01a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../db/d74/structrb__vm__struct.html">rb_vm_struct</a> <a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../da/d0a/vm_8h_source.html#l00034">34</a> of file <a class="el" href="../../da/d0a/vm_8h_source.html">vm.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a450d06a010ca9e1139e5ba87c5cb9e38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ruby_vm_at_exit </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a> *)&#160;</td>
          <td class="paramname"><em>func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ruby_vm_at_exit registers a function <em>func</em> to be invoked when a VM passed away. </p>
<p>Functions registered this way runs in reverse order of registration, just like END {} block does. The difference is its timing to be triggered. ruby_vm_at_exit functions runs when a VM <em>passed</em> <em>away</em>, while END {} blocks runs just <em>before</em> a VM <em>is</em> <em>passing</em> <em>away</em>.</p>
<p>You cannot register a function to another VM than where you are in. So where to register is intuitive, omitted. OTOH the argument <em>func</em> cannot know which VM it is in because at the time of invocation, the VM has already died and there is no execution context. The VM itself is passed as the first argument to it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>the function to register. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00237">237</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

<p>References <a class="el" href="../../d5/d9d/tcltklib_8c_source.html#l00185">at_exit</a>, <a class="el" href="../../dc/dd1/ossl__ssl_8c_source.html#l00108">func</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00876">GET_VM</a>, and <a class="el" href="../../dc/dcc/array_8c_source.html#l00822">rb_ary_push()</a>.</p>

</div>
</div>
<a class="anchor" id="a64b7830f0ac2f5c4e03c3659051b3e4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ruby_vm_destruct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a> *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l01596">1596</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

<p>References <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00346">rb_vm_struct::living_threads</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00343">rb_vm_struct::main_thread</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00387">rb_vm_struct::objspace</a>, <a class="el" href="../../d5/d75/cont_8c_source.html#l01370">rb_fiber_reset_root_local_storage()</a>, <a class="el" href="../../d8/d16/gc_8c_source.html#l02961">rb_gc_force_recycle()</a>, <a class="el" href="../../d8/d16/gc_8c_source.html#l00389">rb_objspace_free()</a>, <a class="el" href="../../d3/de7/thread_8c_source.html#l00273">rb_vm_gvl_destroy()</a>, <a class="el" href="../../d0/daa/gc_8h_source.html#l00055">RUBY_FREE_ENTER</a>, <a class="el" href="../../d0/daa/gc_8h_source.html#l00056">RUBY_FREE_LEAVE</a>, <a class="el" href="../../de/de9/vm_8c_source.html#l00243">ruby_vm_run_at_exit_hooks()</a>, <a class="el" href="../../d8/d16/gc_8c_source.html#l03649">ruby_xfree()</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00338">rb_vm_struct::self</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00494">rb_thread_struct::self</a>, <a class="el" href="../../d4/d71/st_8c_source.html#l00334">st_free_table()</a>, and <a class="el" href="../../de/de9/vm_8c_source.html#l01857">thread_free()</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d57/eval_8c_source.html#l00155">ruby_cleanup()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 4 2013 03:25:22 for Ruby by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
